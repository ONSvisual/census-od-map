import{l as D,d as N,p as H,T as ee,m as te,B as ae,F as se,h as ne,I as oe}from"../chunks/Spinner.2a79048b.js";import{b as I}from"../chunks/paths.67f17f95.js";import{d as re,c as L,a as R}from"../chunks/config.8ad79194.js";import{s as G,r as le,f as E,g as S,h as J,d as m,j as h,k as C,i as g,u as ie,v as fe,w as ce,o as K,a as q,V as ue,c as V,x as O,l as me,m as de,n as pe}from"../chunks/scheduler.e335327d.js";import{S as Q,i as W,a as p,t as $,b as w,d as b,m as v,e as y,g as _e,c as $e}from"../chunks/index.0c5ce9d6.js";function he(i){let t,s;const a=i[2].default,n=le(a,i,i[1],null);return{c(){t=E("div"),n&&n.c(),this.h()},l(e){t=S(e,"DIV",{class:!0});var l=J(t);n&&n.l(l),l.forEach(m),this.h()},h(){h(t,"class","embed-container svelte-ubitk5"),C(t,"display","content")},m(e,l){g(e,t,l),n&&n.m(t,null),s=!0},p(e,[l]){n&&n.p&&(!s||l&2)&&ie(n,a,e,e[1],s?ce(a,e[1],l,null):fe(e[1]),null)},i(e){s||(p(n,e),s=!0)},o(e){$(n,e),s=!1},d(e){e&&m(t),n&&n.d(e)}}}function ge(i,t,s){let{$$slots:a={},$$scope:n}=t,{pymChild:e=null}=t;return K(()=>{s(0,e=new D.Child),setInterval(()=>{e.sendMessage("height",Math.max(document.body.scrollHeight,document.body.offsetHeight))},1e3)}),i.$$set=l=>{"pymChild"in l&&s(0,e=l.pymChild),"$$scope"in l&&s(1,n=l.$$scope)},[e,n,a]}class we extends Q{constructor(t){super(),W(this,t,ge,he,G,{pymChild:0})}}async function be({parent:i,fetch:t,params:s}){const{arealist:a,metadata:n,sources:e,quads:l}=await i(),o=s.key.split("/")[0],r=re.find(_=>_.key===o);let f,u;if(r){u={};const _=await t(`${I}/data/${o}_lad_counts.csv`),A=await t(`${I}/data/${o}_msoa_counts.csv`),k=[...L(await _.text(),R),...L(await A.text(),R)],x={};k.forEach(c=>x[c.areacd]=c),f=x;const X=await t(`${I}/data/${o}_points.json`);u.array=N(await X.json(),(c,d)=>({from:c[0][d],to:c[1][d],x1:c[2][d],y1:c[3][d],x2:c[4][d],y2:c[5][d]})).map(({from:c,to:d,x1:F,y1:T,x2:P,y2:j})=>{var z,B;F===null&&(F=P),P===null&&(P=F),T===null&&(T=j),j===null&&(j=T);let Y=((z=n[c])==null?void 0:z.parentcd)||c,Z=((B=n[d])==null?void 0:B.parentcd)||d;return{x1:F,y1:T,x2:P,y2:j,from_msoa:c,from_lad:Y,to_msoa:d,to_lad:Z}}),u.from=u.array.map(c=>H([c.x1,c.y1])),u.to=u.array.map(c=>H([c.x2,c.y2]))}return{arealist:a,metadata:n,sources:e,quads:l,dataset:r,areadata:f,points:u}}const Ie=Object.freeze(Object.defineProperty({__proto__:null,load:be},Symbol.toStringTag,{value:"Module"}));const{document:M}=te;function U(i){let t,s;return t=new ne({}),{c(){w(t.$$.fragment)},l(a){b(t.$$.fragment,a)},m(a,n){v(t,a,n),s=!0},i(a){s||(p(t.$$.fragment,a),s=!0)},o(a){$(t.$$.fragment,a),s=!1},d(a){y(t,a)}}}function ve(i){let t,s=i[2]?"Close":"Full screen",a,n;return t=new oe({props:{type:i[2]?"full_exit":"full",scale:2,margin:"0 10px 2px 0"}}),{c(){w(t.$$.fragment),a=me(s)},l(e){b(t.$$.fragment,e),a=de(e,s)},m(e,l){v(t,e,l),g(e,a,l),n=!0},p(e,l){const o={};l&4&&(o.type=e[2]?"full_exit":"full"),t.$set(o),(!n||l&4)&&s!==(s=e[2]?"Close":"Full screen")&&pe(a,s)},i(e){n||(p(t.$$.fragment,e),n=!0)},o(e){$(t.$$.fragment,e),n=!1},d(e){e&&m(a),y(t,e)}}}function ye(i){let t,s,a,n,e,l,o=i[1]&&U();return a=new ae({props:{variant:"secondary",small:!0,$$slots:{default:[ve]},$$scope:{ctx:i}}}),a.$on("click",i[6]),e=new se({props:{data:i[0],interactive:Ce,geo:i[4],pos:i[5],highlight:Ee,darkMode:i[3]}}),e.$on("load",i[7]),{c(){o&&o.c(),t=q(),s=E("div"),w(a.$$.fragment),n=q(),w(e.$$.fragment),this.h()},l(r){o&&o.l(r),t=V(r),s=S(r,"DIV",{style:!0});var f=J(s);b(a.$$.fragment,f),f.forEach(m),n=V(r),b(e.$$.fragment,r),this.h()},h(){C(s,"position","fixed"),C(s,"top","8px"),C(s,"right","8px"),C(s,"z-index","1")},m(r,f){o&&o.m(r,f),g(r,t,f),g(r,s,f),v(a,s,null),g(r,n,f),v(e,r,f),l=!0},p(r,f){r[1]?o?f&2&&p(o,1):(o=U(),o.c(),p(o,1),o.m(t.parentNode,t)):o&&(_e(),$(o,1,1,()=>{o=null}),$e());const u={};f&2052&&(u.$$scope={dirty:f,ctx:r}),a.$set(u);const _={};f&1&&(_.data=r[0]),f&8&&(_.darkMode=r[3]),e.$set(_)},i(r){l||(p(o),p(a.$$.fragment,r),p(e.$$.fragment,r),l=!0)},o(r){$(o),$(a.$$.fragment,r),$(e.$$.fragment,r),l=!1},d(r){r&&(m(t),m(s),m(n)),o&&o.d(r),y(a),y(e,r)}}}function ke(i){let t,s;return t=new we({props:{$$slots:{default:[ye]},$$scope:{ctx:i}}}),{c(){w(t.$$.fragment)},l(a){b(t.$$.fragment,a)},m(a,n){v(t,a,n),s=!0},p(a,n){const e={};n&2063&&(e.$$scope={dirty:n,ctx:a}),t.$set(e)},i(a){s||(p(t.$$.fragment,a),s=!0)},o(a){$(t.$$.fragment,a),s=!1},d(a){y(t,a)}}}function Me(i){let t,s,a,n,e,l;return e=new ee({props:{theme:i[3]?"dark":"light",$$slots:{default:[ke]},$$scope:{ctx:i}}}),{c(){t=E("meta"),s=E("meta"),a=E("meta"),n=q(),w(e.$$.fragment),this.h()},l(o){const r=ue("svelte-1h8aoen",M.head);t=S(r,"META",{name:!0,content:!0}),s=S(r,"META",{name:!0,content:!0}),a=S(r,"META",{name:!0,content:!0}),r.forEach(m),n=V(o),b(e.$$.fragment,o),this.h()},h(){M.title="Origin-destination data explorer - Census 2021 - ONS",h(t,"name","description"),h(t,"content","A tool to view animated flows of people moving between places for work or migration, based on data from Census 2021, to a neighbourhood (MSOA) level."),h(s,"name","robots"),h(s,"content","noindex"),h(a,"name","googlebot"),h(a,"content","indexifembedded")},m(o,r){O(M.head,t),O(M.head,s),O(M.head,a),g(o,n,r),v(e,o,r),l=!0},p(o,[r]){const f={};r&8&&(f.theme=o[3]?"dark":"light"),r&2063&&(f.$$scope={dirty:r,ctx:o}),e.$set(f)},i(o){l||(p(e.$$.fragment,o),l=!0)},o(o){$(e.$$.fragment,o),l=!1},d(o){o&&m(n),m(t),m(s),m(a),y(e,o)}}}let Ce=!0,Ee="to";function Se(i,t,s){let{data:a}=t;const n=["lad","msoa"],e=["from","to"];let l=n[0],o=e[0],r=!0,f=!1,u=!0;function _(){f?(document.exitFullscreen(),s(2,f=!1)):(document.body.requestFullscreen(),s(2,f=!0))}K(()=>{window.matchMedia("(prefers-reduced-motion: reduce)")===!0||window.matchMedia("(prefers-reduced-motion: reduce)").matches,new URLSearchParams(document.location.search).get("lightMode")&&s(3,u=!1)});const A=()=>s(1,r=!1);return i.$$set=k=>{"data"in k&&s(0,a=k.data)},[a,r,f,u,l,o,_,A]}class Oe extends Q{constructor(t){super(),W(this,t,Se,Me,G,{data:0})}}export{Oe as component,Ie as universal};
